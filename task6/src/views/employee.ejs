<h3 class="my-4 title" style="text-align: center">
    <% if (!!employee.id) { %>
        Edit employee info
    <% } else { %>
        Add new employee
    <% } %>
</h3>

<form id="form" class="mx-auto" style="width: 40%">
    <input type="hidden" class="form-control" id="id" name="id"  value="<%= employee.id %>" />
    <input type="hidden" class="form-control" id="department" name="department"  value="<%= department %>" />
    <div class="form-group">
        <label for="name">name *</label>
        <input type="text" class="form-control" id="name" name="name"  value="<%= employee.name %>" required/>
    </div>
    <div class="form-group">
        <label for="email">email *</label>
        <span class="validation not-unique pl-4">Value must be unique</span>
        <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                value="<%= employee.email %>"
                required
        />
    </div>
    <div class="form-group">
        <label for="birthday">birthday *</label>
        <input type="text"
               class="form-control"
               id="birthday"
               name="birthday"
               value="<%= employee.birthday %>"
               required
        />
    </div>
    <div class="form-group">
        <label for="salary">salary *</label>
        <input type="number" class="form-control" id="salary" name="salary"  value="<%= employee.salary %>" required/>
    </div>
    <div>
        <input type="submit"
               class="btn btn-secondary float-right"
               value="Save"
        />
        <a href="/employees-list?department=<%= department %>" class="btn btn-secondary"><</a>
    </div>
</form>

<script>
	$(document).ready(function() {
		$.validator.addMethod("dateFormat",
			function(value) {
				return value.match(/(\d{4})-(\d{2})-(\d{2})/);
			},
			"Date format yyyy-mm-dd"
		);
		var handleFormSubmit = function() {
			$('.validation').css('display', 'none');
			$('#form').validate({
				rules: {
					name: 'required',
					email: {
						required: true,
						// email: true,
					},
					birthday: {
						required: true,
						dateFormat : true,
					},
					salary: 'required'
				},
				errorPlacement: function(error, element) {
					error.insertBefore(element);
					error.css('color', 'red');
					error.css('padding-left', '1rem');
				},
				submitHandler: function(form, e) {
					e.preventDefault();
					var data = {
						department: form.department.value,
						id: form.id.value,
						name: form.name.value,
						email: form.email.value,
						birthday: form.birthday.value,
						salary: form.salary.value,
					};
					$.ajax({
						url: '/setEmployee',
						type: 'post',
						data: data,
						success: function() {
							window.location = '/employees-list?department=' + new URLSearchParams(window.location.search).get('department');
						},
						error: function(res) {
							if (res.responseText === 'Email is not unique') {
								$('.not-unique').css('display', 'inline-block');
							}
						}
					})
				},
			});
		}
		$('input[type=submit]').click(function() {
			handleFormSubmit();
		});
	});
</script>
