<h3 class="my-4 title text-center">Sign Up</h3>

<form id="form" class="mx-auto" style="width: 40%">
    <div class="form-group">
        <label for="name">Username</label>
        <span class="validation not-unique pl-4">Value must be unique</span>
        <input type="text" class="form-control" id="username" name="username" required/>
    </div>
    <div class="form-group">
        <label for="password">Password</label>
        <input type="password" class="form-control" id="password" name="password" required/>
    </div>
    <div>
        <input type="submit"
               class="btn btn-secondary float-right"
               style="width: 200px"
               value="Sign up"
        />
        <a href="/login">Log In</a>
    </div>
</form>

<script>

	$(document).ready(function() {
		var handleFormSubmit = function() {
			$('.validation').css('display', 'none');
			$('#form').validate({
				errorPlacement: function(error, element) {
					error.insertBefore(element);
					error.css('color', 'red');
					error.css('padding-left', '1rem');
				},
				submitHandler: function(form, e) {
					e.preventDefault();
					var data = {
						username: form.username.value,
						password: form.password.value,
					};
					$.ajax({
						url: '/signup',
						type: 'post',
						data: data,
						success: function() {
							window.location = '/login';
						},
						error: function(res) {
							if (res.responseText === 'value must be unique') {
								$('.not-unique').css('display', 'inline-block');
							} else {
								$('.error').css('display', 'inline-block');
							}
						}
					})
				},
				invalidHandler: function(err) {
					console.log(err);
				}
			})
		}
		$('input[type=submit]').click(function() {
			handleFormSubmit();
		});
	});

</script>