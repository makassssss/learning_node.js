<h3 class="my-4 title" style="text-align: center">
    <% if (!!id) { %>
        Edit department
    <% } else { %>
        Add new department
    <% } %>
</h3>

<form id="form" class="mx-auto" style="width: 40%">
    <input type="hidden" class="form-control" id="id" name="id" value="<%= id %>"/>
    <div class="form-group">
        <label for="name">department name *</label>
        <span class="validation not-unique pl-4">Value must be unique</span>
        <input type="text" class="form-control" id="name" name="name" value="<%= name %>" required/>
    </div>
    <div>
        <input type="submit"
               class="btn btn-secondary float-right"
               value="Save"
        />
        <a href="/" class="btn btn-secondary"><</a>
    </div>
</form>

<script>
	$(document).ready(function() {
		var handleFormSubmit = function() {
			$('.validation').css('display', 'none');
			$('#form').validate({
				rules: {
					name: 'required',
				},
				errorPlacement: function(error, element) {
					error.insertBefore(element);
					error.css('color', 'red');
					error.css('padding-left', '1rem');
				},
				submitHandler: function(form, e) {
					e.preventDefault();
					var data = {
						id: form.id.value,
						department_name: form.name.value,
					};
					$.ajax({
						url: '/setDepartment',
						type: 'post',
						data: data,
						success: function() {
							window.location = '/';
						},
						error: function(res) {
							if (res.responseText === 'Value is not unique') {
								$('.not-unique').css('display', 'inline-block');
							}
						}
					})
				},
				invalidHandler: function(err) {
					console.log(err);
				}
			})
		}
		$('input[type=submit]').click(function() {
			handleFormSubmit();
		});
	});
</script>
